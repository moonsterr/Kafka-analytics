# docker-kafka/Dockerfile
FROM bitnami/kafka:latest

# Expose Kafka client and controller ports
EXPOSE 9092 9093

# KRaft mode (no Zookeeper)
ENV KAFKA_ENABLE_KRAFT=yes
ENV KAFKA_CFG_PROCESS_ROLES=broker,controller
ENV KAFKA_CFG_NODE_ID=1
ENV KAFKA_CFG_CONTROLLER_LISTENER_NAMES=CONTROLLER
ENV KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP=CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT

# Listen on all interfaces inside the container
ENV KAFKA_CFG_LISTENERS=PLAINTEXT://:9092,CONTROLLER://:9093

# Hardcoded Render host (per your request)
ENV KAFKA_CFG_ADVERTISED_LISTENERS=PLAINTEXT://kafka-analytics.onrender.com:9092
ENV KAFKA_CFG_CONTROLLER_QUORUM_VOTERS=1@kafka-analytics.onrender.com:9093

# Auto-create topics (optional)


# Persist data on Bitnami default path
VOLUME ["/bitnami/kafka"]

# Use Bitnami's entrypoint which reads the ENV vars and starts Kafka
ENTRYPOINT ["/opt/bitnami/scripts/kafka/entrypoint.sh"]
# no CMD â€” entrypoint will start Kafka using the environment above
