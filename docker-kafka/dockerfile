# Use official Confluent Kafka image
FROM confluentinc/cp-kafka:8.8.2

# Expose Kafka ports
EXPOSE 9092 9093

# Environment variables for KRaft mode
ENV KAFKA_KRAFT_MODE=true
ENV KAFKA_BROKER_ID=1
ENV KAFKA_PROCESS_ROLES=broker,controller
ENV KAFKA_LISTENERS=PLAINTEXT://0.0.0.0:9092,CONTROLLER://0.0.0.0:9093
ENV KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://kafka-analytics.onrender.com:9092
ENV KAFKA_CONTROLLER_QUORUM_VOTERS=1@kafka-analytics.onrender.com:9093
ENV KAFKA_AUTO_CREATE_TOPICS_ENABLE=true
ENV KAFKA_LOG_DIRS=/kafka-logs

# Create log directory for persistence
RUN mkdir -p /kafka-logs

# Optional: mount volume for persistent Kafka logs
VOLUME ["/kafka-logs"]

# Start Kafka
CMD ["bash", "-c", "/etc/confluent/docker/run"]
